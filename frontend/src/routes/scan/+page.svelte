<script>
  import { url, vul_list, scan_type, resetState } from "$lib/store";
  import { writable } from "svelte/store";
  import { goto } from '$app/navigation';

  let progress = writable(0);
  let completedChecks = writable([]);
  let showModal = writable(false);

  function cancelScan() {
    //   if (socket) {
    //     socket.close();
    //   }
    resetState();
    goto("/");
  }

  function toggleModal() {
    showModal.update(n => !n);
  }
  // Socket 열고 넣기
  // progress.set((completedChecks.length / (vul_list.length + 2) * 100));
  // 검사 끝나면 자동으로 RESULT 페이지로 넘어가도록

</script>

<main class="h-screen bg-customBlue flex flex-col justify-center items-center relative">
    <div class="w-5/6 flex flex-col justify-center items-center" style="height: 90%">
      <div class="flex justify-center items-center w-full" style="height: 10%">
        <div class="w-11/12 flex items-center bg-gray-200 rounded-full h-1/2 shadow-lg">
          {#if $progress > 0}
            <div class="bg-blue-700 font-medium text-blue-100 h-full flex justify-center items-center leading-none rounded-full min-[1920px]:text-3xl shadow-inner" style="width: {$progress}%">
              {Math.round($progress)}%
            </div>
          {/if}
        </div>
      </div>
      <div class="flex w-11/12" style="height: 80%;">
        <div class="h-full w-1/2 flex flex-col justify-center">
          <span class="w-11/12 flex bg-customDeepBlue justify-center rounded-t-lg items-center text-white min-[1920px]:text-4xl shadow-md" style="height: 7%">검사 대기 중 취약점</span>
          <div class="h-5/6 w-11/12 p-2 bg-gray-200 rounded-b-lg min-[1920px]:text-3xl shadow-lg overflow-auto"></div>
        </div>
        <div class="h-full w-1/2 flex flex-col justify-center items-end">
          <span class="w-11/12 flex bg-customDeepBlue justify-center rounded-t-lg items-center text-white min-[1920px]:text-3xl shadow-md" style="height: 7%">검사 완료 취약점</span>
          <div class="h-5/6 w-11/12 p-2 bg-gray-200 rounded-b-lg min-[1920px]:text-3xl shadow-lg overflow-auto"></div>
        </div>
      </div>
      <div class="w-full flex justify-center items-center" style="height: 10%">
        <button class="bg-gray-100 h-1/2 w-1/12 rounded-lg min-[1920px]:text-2xl hover:scale-105 shadow-md" on:click={toggleModal}>검사 취소</button>
      </div>
    </div>
  
    {#if $showModal}
      <div class="absolute top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center">
        <div class="bg-white p-6 rounded-lg shadow-lg text-center relative z-50">
          <p class="min-[1920px]:text-2xl mb-4">정말 검사를 종료하시겠습니까?<br>현재까지 진행한 검사 내역이 모두 지워집니다.</p>
          <div class="flex justify-center space-x-4">
            <button class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-700" on:click={cancelScan}>확인</button>
            <button class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-700" on:click={toggleModal}>취소</button>
          </div>
        </div>
      </div>
    {/if}
    <!-- 추후 삭제-->
    <button class="bg-gray-500" on:click={()=>goto('/result')}>결과 페이지 보기</button>
  </main>
