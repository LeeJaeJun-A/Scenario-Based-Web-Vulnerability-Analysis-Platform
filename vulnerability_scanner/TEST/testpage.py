from flask import Flask, request, session, make_response, render_template_string

app = Flask(__name__)
app.secret_key = 'supersecretkey'

# 임시로 댓글을 저장할 리스트
comments = []

@app.route('/', methods=['GET', 'POST'])
def index():
    # GET 파라미터
    get_params = request.args.to_dict()

    # POST 파라미터
    post_params = request.form.to_dict()

    # 세션에 GET 파라미터 저장
    for key, value in get_params.items():
        session[key] = value

    # 세션에 POST 파라미터 저장 및 댓글 추가
    if request.method == 'POST' and 'comment' in post_params:
        comments.append(post_params['comment'])
        session['last_comment'] = post_params['comment']

    # 쿠키 설정
    response = make_response()
    for key, value in get_params.items():
        response.set_cookie(key, value)
    for key, value in post_params.items():
        response.set_cookie(key, value)

    # 쿠키 가져오기
    cookies = request.cookies

    # 세션 값 가져오기
    session_values = session.items()

    # HTML 템플릿
    response_content = '''
    <h1>Comment Section</h1>
    <form method="POST" action="/">
        <label for="comment">Write a comment:</label><br>
        <input type="text" id="comment" name="comment"><br><br>
        <input type="submit" value="Submit">
    </form>
    <h2>Comments</h2>
    {% if comments %}
        <ul>
        {% for comment in comments %}
            <li>{{ comment }}</li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No comments yet</p>
    {% endif %}

    <h2>GET Parameters</h2>
    {% if get_params %}
        <ul>
        {% for key, value in get_params.items() %}
            <li>{{ key }}: {{ value }}</li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No GET parameters</p>
    {% endif %}

    <h2>POST Parameters</h2>
    {% if post_params %}
        <ul>
        {% for key, value in post_params.items() %}
            <li>{{ key }}: {{ value }}</li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No POST parameters</p>
    {% endif %}

    <h2>Cookies</h2>
    {% if cookies %}
        <ul>
        {% for key, value in cookies.items() %}
            <li>{{ key }}: {{ value }}</li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No Cookies</p>
    {% endif %}

    <h2>Session Values</h2>
    {% if session_values %}
        <ul>
        {% for key, value in session_values %}
            <li>{{ key }}: {{ value }}</li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No Session values</p>
    {% endif %}
    '''
    
    response.set_data(render_template_string(response_content, get_params=get_params, post_params=post_params, cookies=cookies, session_values=session_values, comments=comments))
    return response

if __name__ == '__main__':
    app.run(debug=True, port=1399)
